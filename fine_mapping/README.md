# Fine-mapping

![Fine-mapping results](https://github.com/rivas-lab/biomarkers/raw/master/fine_mapping/figs/fig3.png)

## The fine-mapping analysis was performed with FINEMAP

## Post-processing

`filtration` directory contains the scripts used for the post-processing.

## Summary figure

To generate the figure for the fine-mapping analysis (written in `figs` directory), we used the following scripts:

0. `filteration/generate_filtered_regions.sh`
1. `parseFinemapOutputForFigure3.r`
2. `plotFinemapFigure3.ipynb` (this is the same content as in `plotFinemapFigure3.r`)
3. `plotFinemapFigure3.per.trait.R` 

```
[ytanigaw@sh-109-54 ~/repos/rivas-lab/biomarkers/fine_mapping]$ cat ../cascade/cascade.input.files.tsv | awk -v FS='\t' '(NR>1){print $2}' | while read p ; do echo $p; Rscript plotFinemapFigure3.per.trait.R ${p} ; done
```

The results are saved and copied to the Google Drive shared folder: https://drive.google.com/drive/folders/1i6w0qQRfrv-vEi7NIMh2yoSsCgTYtdE-

### `plotFinemapFigure3_count_summary.tsv`

The numbers shown in the plots (`fig3.png` and `fig3.{trait}.png`) are summarized in a table `plotFinemapFigure3_count_summary.tsv`. This table is generated by a notebook `plotFinemapFigure3_count_summary.ipynb`.

We have the following columns in this table file.
- name: the name of the phenotypes for plotting (from `commons/cascade.input.files.tsv`)
- trait: the name of the phenotypes (for computing)
- n_regions: number of regions
- n_signals: number of signals
- sr<number>: n_signal_per_region
- ss<number>: n_snps_per_signal

## Generate the list of fine-mapped variants

We applied additional filters on fine-mapped variants (p < 5e-9 AND posterior prob > .99) and prepared as a table.
In that table, we added variant annotation as well as the index of the region.
`filtered_hits` has the scripts used for this analysis.

